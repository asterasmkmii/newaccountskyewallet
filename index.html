<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SKYLINES eWallet Portal Registration</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
html, body { height: 100%; margin:0; font-family: 'Montserrat', sans-serif; background:#f5f5f5; display:flex; flex-direction:column; }
body { min-height: 100vh; }
.form-container { background:#fff; padding:30px; border:1px solid #000; width:450px; box-sizing:border-box; margin:40px auto; flex:none; }
.header { text-align:left; margin-bottom:15px; }
.header p:first-child { font-weight:bold; font-size:16px; margin:0 0 5px 0; }
.info-note { font-size:14px; color:#555; line-height:1.5; margin:0; }
.step-hint { font-size:13px; margin-bottom:10px; font-weight:700; }
.form-step { display:none; } .form-step.active { display:block; }
.form-field { display:flex; align-items:center; margin:8px 0; gap:10px; }
.form-field label { width:120px; font-weight:bold; font-size:14px; }
.form-field input { flex:1; padding:12px 15px; border-radius:25px; border:1px solid #000; font-size:15px; }
.form-field input:focus { outline:none; border-color:#007bff; }
.button-group { display:flex; justify-content:space-between; margin-top:15px; gap:10px; }
.btn { flex:1; padding:12px; border-radius:50px; border:1px solid #000; font-weight:bold; font-size:15px; cursor:pointer; background:transparent; transition:all 0.2s ease; color:#000; }
.btn-next { border-color:#007bff; color:#007bff; } .btn-next:hover { background-color:#007bff; color:#fff; }
.btn-back { border-color:#555; color:#555; } .btn-back:hover { background-color:#555; color:#fff; }
.btn-batalkan { border-color:#ff5f00; color:#ff5f00; } .btn-batalkan:hover { background-color:#ff5f00; color:#fff; }
.checkbox-group { display:flex; align-items:center; margin:15px 0; font-size:14px; }
.checkbox-group input[type="checkbox"] { margin-right:10px; }
.checkbox-group a { margin-left:5px; color:#007bff; text-decoration:none; font-weight:bold; }
.checkbox-group a:hover { text-decoration:underline; }
footer { background:#111; color:#fff; padding:10px 20px; display:flex; justify-content:space-between; align-items:center; font-size:16px; width:100%; box-sizing:border-box; margin-top:auto; }
.marquee { flex:1; margin-left:20px; overflow:hidden; white-space:nowrap; }
.marquee span { display:inline-block; padding-left:100%; animation: scroll 15s linear infinite; }
@keyframes scroll { from {transform:translateX(0);} to {transform:translateX(-100%);} }
</style>
</head>
<body>

<div class="form-container">
  <div class="header">
    <p>Daftar Akaun SKYLINES eWallet Baru</p>
    <p class="info-note">Sila daftarkan SKYLINES eWallet anda dan lengkapkan proses KYC. Kemas kini nama penuh anda mengikut maklumat dari KAD PENGENALAN ANDA. Percanggahan dalam butiran profil boleh mengakibatkan penolakan pembikinan akaun.</p>
  </div>

  <form id="multi-step-form">
    <!-- Step 1 -->
    <div class="form-step active" data-step="1">
      <div class="step-hint">LANGKAH 1: NAMA DAN TARIKH LAHIR</div>
      <div class="form-field"><label for="first-name">NAMA AWAL</label><input type="text" id="first-name" name="first-name" placeholder="SITI" required></div>
      <div class="form-field"><label for="last-name">NAMA TERAKHIR</label><input type="text" id="last-name" name="last-name" placeholder="BIN .........." required></div>
      <div class="form-field"><label for="dob">TARIKH LAHIR</label><input type="date" id="dob" name="dob" required></div>
      <div class="button-group">
        <button type="button" class="btn btn-batalkan" onclick="window.location.href='https://https://asterasmkmii.github.io/atmhomesw/'">Batalkan</button>
        <button type="button" class="btn btn-next" onclick="nextStep()">Seterusnya</button>
      </div>
    </div>

    <!-- Step 2 -->
    <div class="form-step" data-step="2">
      <div class="step-hint">LANGKAH 2: ALAMAT, NOMBOR TELEFON DAN EMEL</div>
      <div class="form-field"><label for="address">ALAMAT</label><input type="text" id="address" name="address" placeholder="Alamat" required></div>
      <div class="form-field"><label for="phone">NOMBOR TEL</label><input type="tel" id="phone" name="phone" placeholder="Telefon" required></div>
      <div class="form-field"><label for="email">EMEL</label><input type="email" id="email" name="email" placeholder="Email" required></div>
      <div class="button-group">
        <button type="button" class="btn btn-back" onclick="prevStep()">Sebelumnya</button>
        <button type="button" class="btn btn-next" onclick="nextStep()">Seterusnya</button>
      </div>
    </div>

    <!-- Step 3: PIN -->
    <div class="form-step" data-step="3">
      <div class="step-hint">LANGKAH 3: Tetapkan 6 Digit PIN</div>
      <div class="form-field"><label for="pin">PIN</label><input type="password" id="pin" name="pin" maxlength="6" pattern="\d{6}" placeholder="6 Digit PIN" required></div>
      <div class="form-field"><label for="pin-confirm">Sahkan PIN</label><input type="password" id="pin-confirm" name="pin-confirm" maxlength="6" pattern="\d{6}" placeholder="Sahkan PIN" required></div>
      <div class="button-group">
        <button type="button" class="btn btn-back" onclick="prevStep()">Sebelumnya</button>
        <button type="button" class="btn btn-next" onclick="nextStep()">Seterusnya</button>
      </div>
    </div>

    <!-- Step 4: Terms + Next -->
    <div class="form-step" data-step="4">
      <div class="step-hint">LANGKAH 4: Terma & Ringkasan</div>
      <div class="checkbox-group">
        <input type="checkbox" id="terms">
        <label for="terms">Saya patuhi terma dan syarat</label>
        <a href="#" target="_blank">Terma & Syarat</a>
      </div>
      <div style="margin-top:15px;">
        <strong>Ringkasan Maklumat:</strong>
        <p>Nama: <span id="summary-name"></span></p>
        <p>Nombor Tel: <span id="summary-phone"></span></p>
        <p>Email: <span id="summary-email"></span></p>
      </div>
      <div class="button-group">
        <button type="button" class="btn btn-back" onclick="prevStep()">Sebelumnya</button>
        <button type="button" class="btn btn-next" id="step4-next" onclick="nextStep()" disabled>Seterusnya</button>
      </div>
    </div>

    <!-- Step 5: Share as Image -->
    <div class="form-step" data-step="5">
      <div class="step-hint">LANGKAH 5: Resit Maklumat</div>
      <div id="share-summary" style="background:#fff; padding:15px; border:1px solid #000;">
        <strong>Maklumat anda:</strong>
        <p>Nama: <span id="summary-name2"></span></p>
        <p>TARIKH LAHIR: <span id="summary-dob2"></span></p>
        <p>Alamat: <span id="summary-address2"></span></p>
        <p>Nombor Tel: <span id="summary-phone2"></span></p>
        <p>Email: <span id="summary-email2"></span></p>
      </div>
      <div class="button-group" style="margin-top:15px;">
        <button type="button" class="btn btn-back" onclick="prevStep()">Sebelumnya</button>
        <button type="button" class="btn btn-next" onclick="shareImage()">Cetak</button>
        <button type="button" class="btn btn-batalkan" onclick="window.location.href='https://https://asterasmkmii.github.io/atmhomesw/'">Balik</button>
      </div>
    </div>
  </form>
</div>

<footer>
  <div id="datetime"></div>
  <div class="marquee"><span>SELAMAT DATANG KE ATM SKYLINES E-WALLET | ATM INI HANYA BUKA DARI 8:00 PAGI HINGGA 10:00 MALAM | SELAMAT MENGGUNA</span></div>
</footer>

<script>
// Firebase config awak
const firebaseConfig = {
  apiKey: "AIzaSyDcAq_rnJ3342lCpxalebddMFGDFUrypUg",
  authDomain: "aeris-data-smkmii.firebaseapp.com",
  projectId: "aeris-data-smkmii",
  storageBucket: "aeris-data-smkmii.firebasestorage.app",
  messagingSenderId: "660083140877",
  appId: "1:660083140877:web:ebc7787b870c12e268e844"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Clock
function updateClock(){
  const now=new Date();
  document.getElementById("datetime").textContent=
    now.toLocaleDateString("ms-MY",{weekday:"long",year:"numeric",month:"long",day:"numeric"})+
    " | "+now.toLocaleTimeString("ms-MY");
}
setInterval(updateClock,1000); updateClock();

// Multi-step form
let currentStep = 1;
const steps = document.querySelectorAll(".form-step");
function showStep(n){
  steps.forEach(s=>s.classList.remove("active"));
  const step = document.querySelector(`.form-step[data-step="${n}"]`);
  step.classList.add("active");

  if(n===4 || n===5){ fillSummary(); }

  // Save data to Firebase automatically when step 5 muncul
  if(n===5){ submitToFirebase(); }
}
function nextStep(){
  if(currentStep===1 && !document.getElementById('first-name').value) return alert('Isi nama awal dahulu');
  if(currentStep===2 && !document.getElementById('address').value) return alert('Isi alamat dahulu');
  if(currentStep===3){
    const pin = document.getElementById('pin').value;
    const pinConfirm = document.getElementById('pin-confirm').value;
    if(pin.length!==6 || pin!==pinConfirm) return alert('PIN tidak sah atau tidak sepadan');
  }
  if(currentStep===4 && !document.getElementById('terms').checked){
    return alert('Sila setuju terma & syarat dahulu');
  }
  if(currentStep<5){ currentStep++; showStep(currentStep); }
}
function prevStep(){ if(currentStep>1){ currentStep--; showStep(currentStep); } }

function fillSummary(){
  const name = document.getElementById('first-name').value + ' ' + document.getElementById('last-name').value;
  const dob = document.getElementById('dob').value;
  const address = document.getElementById('address').value;
  const phone = document.getElementById('phone').value;
  const email = document.getElementById('email').value;

  document.getElementById('summary-name').textContent = name;
  document.getElementById('summary-dob').textContent = dob;
  document.getElementById('summary-address').textContent = address;
  document.getElementById('summary-phone').textContent = phone.replace(/.(?=.{2})/g,"*");
  document.getElementById('summary-email').textContent = email.replace(/.(?=.{3}@)/g,"*");

  document.getElementById('summary-name2').textContent = name;
  document.getElementById('summary-dob2').textContent = dob;
  document.getElementById('summary-address2').textContent = address;
  document.getElementById('summary-phone2').textContent = phone.replace(/.(?=.{2})/g,"*");
  document.getElementById('summary-email2').textContent = email.replace(/.(?=.{3}@)/g,"*");
}

// Enable Next button in Step 4 only if terms ticked
const termsCheckbox = document.getElementById('terms');
const step4NextBtn = document.getElementById('step4-next');
termsCheckbox.addEventListener('change', ()=>{
  step4NextBtn.disabled = !termsCheckbox.checked;
  step4NextBtn.style.opacity = termsCheckbox.checked ? '1' : '0.5';
});

// Submit to Firestore with token=false
function submitToFirebase(){
  db.collection("registerations").add({
    firstName: document.getElementById('first-name').value,
    lastName: document.getElementById('last-name').value,
    dob: document.getElementById('dob').value,
    address: document.getElementById('address').value,
    phone: document.getElementById('phone').value,
    email: document.getElementById('email').value,
    pin: document.getElementById('pin').value,
    token: false,
    finalconfirm: false,
    timestamp: firebase.firestore.FieldValue.serverTimestamp()
  })
  .then(()=>console.log("Data saved to Firestore with token=false"))
  .catch(err=>console.error("Firestore error:",err));
}

// Share as image
function shareImage(){
  submitToFirebase();
  const element = document.getElementById('share-summary');
  html2canvas(element).then(canvas=>{
    canvas.toBlob(blob=>{
      const file = new File([blob], "SKYLINES_Summary.png",{type:"image/png"});
      if(navigator.share){
        navigator.share({
          files:[file],
          title:"SKYLINES eWallet Registration",
          text:"Ringkasan Pendaftaran SKYLINES eWallet"
        }).then(()=>{}).catch(err=>alert('Gagal share: '+err));
      } else {
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = "SKYLINES_Summary.png";
        a.click();
        URL.revokeObjectURL(url);
      }
    });
  });
}
</script>

</body>
</html>
